<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Winning Side</title>
<style>
  body {
    background-color: #121212;
    color: white;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
  }
  .container {
    max-width: 900px;
    margin: auto;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 10px;
  }
  .players-list {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    background: #1f1f1f;
    border-radius: 8px;
    margin-bottom: 10px;
  }
  .player {
    flex: 1;
    text-align: center;
  }
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 10px;
  }
  .card {
    background: #1f1f1f;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s ease-in-out;
  }
  .card:hover {
    border-color: yellow;
  }
  .selected {
    border-color: green !important;
  }
  .waiting {
    opacity: 0.6;
    pointer-events: none;
  }
  .score {
    font-size: 0.9em;
    color: #bbb;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Winning Side</h1>
  <div class="players-list">
    <div class="player" id="player1-name">Player 1 <span class="score" id="player1-score">(0)</span></div>
    <div class="player" id="player2-name">Player 2 <span class="score" id="player2-score">(0)</span></div>
  </div>
  <div id="status" style="text-align:center; margin-bottom: 10px;"></div>
  <div class="cards-grid" id="cards-grid"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // ===== Firebase Setup (unchanged) =====
  const firebaseConfig = {
    apiKey: "AIzaSyCtti9Ll57zmSXvG4RofN_yQa7y2uVCGC0",
    authDomain: "winning-team-6364c.firebaseapp.com",
    projectId: "winning-team-6364c",
    storageBucket: "winning-team-6364c.firebasestorage.app",
    messagingSenderId: "944401986892",
    appId: "1:944401986892:web:8fad1c4d395acceed50be9",
    measurementId: "G-B8TT9WKWEX"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ===== Players List with Ratings =====
  const ALL_PLAYERS = [
        // GK (16)
        { id: "yashin", name: "Lev Yashin", country: "USSR", position: "GK", rating: 97 },
        { id: "buffon", name: "Gianluigi Buffon", country: "Italy", position: "GK", rating: 94 },
        { id: "casillas", name: "Iker Casillas", country: "Spain", position: "GK", rating: 92 },
        { id: "schmeichel", name: "Peter Schmeichel", country: "Denmark", position: "GK", rating: 93 },
        { id: "maier", name: "Sepp Maier", country: "Germany", position: "GK", rating: 91 },
        { id: "zoff", name: "Dino Zoff", country: "Italy", position: "GK", rating: 92 },
        { id: "kahn", name: "Oliver Kahn", country: "Germany", position: "GK", rating: 93 },
        { id: "banks", name: "Gordon Banks", country: "England", position: "GK", rating: 92 },
        { id: "chilavert", name: "José Luis Chilavert", country: "Paraguay", position: "GK", rating: 89 },
        { id: "higuita", name: "René Higuita", country: "Colombia", position: "GK", rating: 87 },
        { id: "vanDerSar", name: "Edwin van der Sar", country: "Netherlands", position: "GK", rating: 91 },
        { id: "deGeaOld", name: "David de Gea", country: "Spain", position: "GK", rating: 88 },
        { id: "dasaev", name: "Rinat Dasayev", country: "USSR", position: "GK", rating: 91 },
        { id: "valdes", name: "Víctor Valdés", country: "Spain", position: "GK", rating: 88 },
        { id: "seaman", name: "David Seaman", country: "England", position: "GK", rating: 89 },
        { id: "schwarzer", name: "Mark Schwarzer", country: "Australia", position: "GK", rating: 85 },

        // DEF (32)
        { id: "maldini", name: "Paolo Maldini", country: "Italy", position: "DEF", rating: 96 },
        { id: "beckenbauer", name: "Franz Beckenbauer", country: "Germany", position: "DEF", rating: 97 },
        { id: "cafu", name: "Cafu", country: "Brazil", position: "DEF", rating: 90 },
        { id: "carlosalberto", name: "Carlos Alberto", country: "Brazil", position: "DEF", rating: 92 },
        { id: "robertocarlos", name: "Roberto Carlos", country: "Brazil", position: "DEF", rating: 92 },
        { id: "ferdinand", name: "Rio Ferdinand", country: "England", position: "DEF", rating: 90 },
        { id: "puyol", name: "Carles Puyol", country: "Spain", position: "DEF", rating: 91 },
        { id: "baresi", name: "Franco Baresi", country: "Italy", position: "DEF", rating: 95 },
        { id: "montero", name: "Paolo Montero", country: "Uruguay", position: "DEF", rating: 87 },
        { id: "zanetti", name: "Javier Zanetti", country: "Argentina", position: "DEF", rating: 92 },
        { id: "lahm", name: "Philipp Lahm", country: "Germany", position: "DEF", rating: 92 },
        { id: "ramos", name: "Sergio Ramos", country: "Spain", position: "DEF", rating: 92 },
        { id: "hierro", name: "Fernando Hierro", country: "Spain", position: "DEF", rating: 91 },
        { id: "cole", name: "Ashley Cole", country: "England", position: "DEF", rating: 90 },
        { id: "vidic", name: "Nemanja Vidić", country: "Serbia", position: "DEF", rating: 91 },
        { id: "campbell", name: "Sol Campbell", country: "England", position: "DEF", rating: 89 },
        { id: "desailly", name: "Marcel Desailly", country: "France", position: "DEF", rating: 92 },
        { id: "moore", name: "Bobby Moore", country: "England", position: "DEF", rating: 95 },
        { id: "cannavaro", name: "Fabio Cannavaro", country: "Italy", position: "DEF", rating: 94 },
        { id: "nesta", name: "Alessandro Nesta", country: "Italy", position: "DEF", rating: 93 },
        { id: "tassotti", name: "Mauro Tassotti", country: "Italy", position: "DEF", rating: 88 },
        { id: "alba", name: "Jordi Alba", country: "Spain", position: "DEF", rating: 88 },
        { id: "godin", name: "Diego Godín", country: "Uruguay", position: "DEF", rating: 90 },
        { id: "ayala", name: "Roberto Ayala", country: "Argentina", position: "DEF", rating: 90 },
        { id: "brehme", name: "Andreas Brehme", country: "Germany", position: "DEF", rating: 90 },
        { id: "koeman", name: "Ronald Koeman", country: "Netherlands", position: "DEF", rating: 92 },
        { id: "stam", name: "Jaap Stam", country: "Netherlands", position: "DEF", rating: 90 },
        { id: "thuram", name: "Lilian Thuram", country: "France", position: "DEF", rating: 92 },
        { id: "figueroa", name: "Elias Figueroa", country: "Chile", position: "DEF", rating: 93 },
        { id: "scirea", name: "Gaetano Scirea", country: "Italy", position: "DEF", rating: 93 },
        { id: "facchetti", name: "Giacinto Facchetti", country: "Italy", position: "DEF", rating: 93 },
        { id: "santamaria", name: "José Santamaría", country: "Uruguay", position: "DEF", rating: 92 },
        { id: "passarella", name: "Daniel Passarella", country: "Argentina", position: "DEF", rating: 94 },

        // MID (36)
        { id: "zidane", name: "Zinedine Zidane", country: "France", position: "MID", rating: 97 },
        { id: "xavi", name: "Xavi", country: "Spain", position: "MID", rating: 95 },
        { id: "iniesta", name: "Andres Iniesta", country: "Spain", position: "MID", rating: 95 },
        { id: "pirlo", name: "Andrea Pirlo", country: "Italy", position: "MID", rating: 94 },
        { id: "scholes", name: "Paul Scholes", country: "England", position: "MID", rating: 90 },
        { id: "beckham", name: "David Beckham", country: "England", position: "MID", rating: 89 },
        { id: "platini", name: "Michel Platini", country: "France", position: "MID", rating: 95 },
        { id: "kaka", name: "Kaká", country: "Brazil", position: "MID", rating: 92 },
        { id: "ronaldinho", name: "Ronaldinho", country: "Brazil", position: "MID", rating: 95 },
        { id: "matthaus", name: "Lothar Matthäus", country: "Germany", position: "MID", rating: 93 },
        { id: "riquelme", name: "Juan Román Riquelme", country: "Argentina", position: "MID", rating: 92 },
        { id: "lampard", name: "Frank Lampard", country: "England", position: "MID", rating: 90 },
        { id: "gerrard", name: "Steven Gerrard", country: "England", position: "MID", rating: 91 },
        { id: "figo", name: "Luís Figo", country: "Portugal", position: "MID", rating: 93 },
        { id: "modric", name: "Luka Modrić", country: "Croatia", position: "MID", rating: 94 },
        { id: "busquets", name: "Sergio Busquets", country: "Spain", position: "MID", rating: 92 },
        { id: "davids", name: "Edgar Davids", country: "Netherlands", position: "MID", rating: 90 },
        { id: "seedorf", name: "Clarence Seedorf", country: "Netherlands", position: "MID", rating: 92 },
        { id: "schweinsteiger", name: "Bastian Schweinsteiger", country: "Germany", position: "MID", rating: 90 },
        { id: "gullit", name: "Ruud Gullit", country: "Netherlands", position: "MID", rating: 93 },
        { id: "nedved", name: "Pavel Nedvěd", country: "Czech Republic", position: "MID", rating: 93 },
        { id: "rivaldo", name: "Rivaldo", country: "Brazil", position: "MID", rating: 93 },
        { id: "dunga", name: "Dunga", country: "Brazil", position: "MID", rating: 90 },
        { id: "socrates", name: "Sócrates", country: "Brazil", position: "MID", rating: 93 },
        { id: "totti", name: "Francesco Totti", country: "Italy", position: "MID", rating: 93 },
        { id: "zico", name: "Zico", country: "Brazil", position: "MID", rating: 95 },
        { id: "redondo", name: "Fernando Redondo", country: "Argentina", position: "MID", rating: 92 },
        { id: "makalele", name: "Claude Makélélé", country: "France", position: "MID", rating: 91 },
        { id: "kante", name: "N'Golo Kanté", country: "France", position: "MID", rating: 91 },
        { id: "yaya", name: "Yaya Touré", country: "Côte d'Ivoire", position: "MID", rating: 91 },
        { id: "essien", name: "Michael Essien", country: "Ghana", position: "MID", rating: 89 },
        { id: "sammer", name: "Matthias Sammer", country: "Germany", position: "MID", rating: 91 },
        { id: "keane", name: "Roy Keane", country: "Ireland", position: "MID", rating: 90 },
        { id: "veron", name: "Juan Sebastián Verón", country: "Argentina", position: "MID", rating: 90 },
        { id: "iniesta10", name: "Hristo Stoichkov (AM)", country: "Bulgaria", position: "MID", rating: 91 },
        { id: "baggio10", name: "Roberto Baggio (AM)", country: "Italy", position: "MID", rating: 94 },
        { id: "deco", name: "Deco", country: "Portugal", position: "MID", rating: 90 },

        // FWD (40+)
        { id: "pele", name: "Pelé", country: "Brazil", position: "FWD", rating: 99 },
        { id: "maradona", name: "Diego Maradona", country: "Argentina", position: "FWD", rating: 99 },
        { id: "ronaldo", name: "Ronaldo Nazário", country: "Brazil", position: "FWD", rating: 97 },
        { id: "cruyff", name: "Johan Cruyff", country: "Netherlands", position: "FWD", rating: 97 },
        { id: "henry", name: "Thierry Henry", country: "France", position: "FWD", rating: 94 },
        { id: "shevchenko", name: "Andriy Shevchenko", country: "Ukraine", position: "FWD", rating: 92 },
        { id: "batistuta", name: "Gabriel Batistuta", country: "Argentina", position: "FWD", rating: 94 },
        { id: "vanbasten", name: "Marco van Basten", country: "Netherlands", position: "FWD", rating: 96 },
        { id: "eusebio", name: "Eusébio", country: "Portugal", position: "FWD", rating: 95 },
        { id: "muller", name: "Gerd Müller", country: "Germany", position: "FWD", rating: 96 },
        { id: "romario", name: "Romário", country: "Brazil", position: "FWD", rating: 95 },
        { id: "baggio", name: "Roberto Baggio", country: "Italy", position: "FWD", rating: 94 },
        { id: "weah", name: "George Weah", country: "Liberia", position: "FWD", rating: 91 },
        { id: "raul", name: "Raúl", country: "Spain", position: "FWD", rating: 94 },
        { id: "stoichkov", name: "Hristo Stoichkov", country: "Bulgaria", position: "FWD", rating: 93 },
        { id: "bergkamp", name: "Dennis Bergkamp", country: "Netherlands", position: "FWD", rating: 93 },
        { id: "lineker", name: "Gary Lineker", country: "England", position: "FWD", rating: 92 },
        { id: "rush", name: "Ian Rush", country: "Wales", position: "FWD", rating: 91 },
        { id: "delpiero", name: "Alessandro Del Piero", country: "Italy", position: "FWD", rating: 93 },
        { id: "inzaghi", name: "Filippo Inzaghi", country: "Italy", position: "FWD", rating: 89 },
        { id: "klinsmann", name: "Jürgen Klinsmann", country: "Germany", position: "FWD", rating: 91 },
        { id: "shearer", name: "Alan Shearer", country: "England", position: "FWD", rating: 94 },
        { id: "fowler", name: "Robbie Fowler", country: "England", position: "FWD", rating: 89 },
        { id: "owen", name: "Michael Owen", country: "England", position: "FWD", rating: 90 },
        { id: "etoo", name: "Samuel Eto'o", country: "Cameroon", position: "FWD", rating: 93 },
        { id: "zlatan", name: "Zlatan Ibrahimović", country: "Sweden", position: "FWD", rating: 92 },
        { id: "ronaldinhoF", name: "Ronaldinho (FWD)", country: "Brazil", position: "FWD", rating: 94 },
        { id: "rivaldoF", name: "Rivaldo (FWD)", country: "Brazil", position: "FWD", rating: 93 },
        { id: "klose", name: "Miroslav Klose", country: "Germany", position: "FWD", rating: 91 },
        { id: "crespo", name: "Hernán Crespo", country: "Argentina", position: "FWD", rating: 91 },
        { id: "aguero", name: "Sergio Agüero", country: "Argentina", position: "FWD", rating: 92 },
        { id: "torres", name: "Fernando Torres", country: "Spain", position: "FWD", rating: 90 },
        { id: "villa", name: "David Villa", country: "Spain", position: "FWD", rating: 91 },
        { id: "papin", name: "Jean-Pierre Papin", country: "France", position: "FWD", rating: 90 },
        { id: "sanchez", name: "Hugo Sánchez", country: "Mexico", position: "FWD", rating: 94 },
        { id: "rummenigge", name: "Karl-Heinz Rummenigge", country: "Germany", position: "FWD", rating: 94 },
        { id: "cantona", name: "Eric Cantona", country: "France", position: "FWD", rating: 92 },
        { id: "rossi", name: "Paolo Rossi", country: "Italy", position: "FWD", rating: 92 },
        { id: "ginola", name: "David Ginola", country: "France", position: "FWD", rating: 88 },
        { id: "litmanen", name: "Jari Litmanen", country: "Finland", position: "FWD", rating: 89 },
        { id: "suker", name: "Davor Šuker", country: "Croatia", position: "FWD", rating: 92 },
        { id: "rooney", name: "Wayne Rooney", country: "England", position: "FWD", rating: 92 },
        { id: "dalglish", name: "Kenny Dalglish", country: "Scotland", position: "FWD", rating: 93 },
        { id: "law", name: "Denis Law", country: "Scotland", position: "FWD", rating: 92 },
        { id: "greaves", name: "Jimmy Greaves", country: "England", position: "FWD", rating: 94 }
      ];


  // ===== Game State =====
  let playerId = localStorage.getItem("playerId") || `p_${Math.random().toString(36).substr(2, 9)}`;
  localStorage.setItem("playerId", playerId);

  let roomId = localStorage.getItem("roomId") || null;
  let isPlayer1 = localStorage.getItem("isPlayer1") === "true";
  let unsubscribeRoom = null;

  function renderCards() {
    const grid = document.getElementById("cards-grid");
    grid.innerHTML = "";
    ALL_PLAYERS.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      card.setAttribute("data-id", p.id);
      card.innerHTML = `<strong>${p.name}</strong><br>${p.country}<br>(${p.rating})`;
      card.onclick = () => selectCard(p.id);
      grid.appendChild(card);
    });
  }

  async function joinOrCreateRoom() {
    if (roomId) {
      const roomRef = db.collection("rooms").doc(roomId);
      const roomSnap = await roomRef.get();
      if (roomSnap.exists) {
        const room = roomSnap.data();
        if (room.player1 === playerId) {
          isPlayer1 = true;
        } else if (room.player2 === playerId) {
          isPlayer1 = false;
        } else if (!room.player1) {
          await roomRef.update({ player1: playerId });
          isPlayer1 = true;
        } else if (!room.player2) {
          await roomRef.update({ player2: playerId });
          isPlayer1 = false;
        }
        localStorage.setItem("isPlayer1", isPlayer1);
        listenToRoom(roomRef);
        return;
      }
    }
    const newRoomRef = db.collection("rooms").doc();
    await newRoomRef.set({
      player1: playerId,
      player2: null,
      scores: { player1: 0, player2: 0 },
      selections: {},
      updated: Date.now()
    });
    roomId = newRoomRef.id;
    localStorage.setItem("roomId", roomId);
    isPlayer1 = true;
    localStorage.setItem("isPlayer1", "true");
    listenToRoom(newRoomRef);
  }

  function listenToRoom(roomRef) {
    if (unsubscribeRoom) unsubscribeRoom();
    unsubscribeRoom = roomRef.onSnapshot(doc => {
      const data = doc.data();
      if (!data) return;
      document.getElementById("player1-score").innerText = `(${data.scores.player1})`;
      document.getElementById("player2-score").innerText = `(${data.scores.player2})`;
      if (data.selections) {
        for (const [pid, cid] of Object.entries(data.selections)) {
          const cardEl = document.querySelector(`[data-id="${cid}"]`);
          if (cardEl) cardEl.classList.add("selected");
        }
      }
    });
  }

  async function selectCard(cardId) {
    if (!roomId) return;
    const roomRef = db.collection("rooms").doc(roomId);
    const key = isPlayer1 ? "player1" : "player2";
    await roomRef.update({
      [`selections.${key}`]: cardId,
      updated: Date.now()
    });
  }

  renderCards();
  joinOrCreateRoom();
</script>
</body>
</html>
