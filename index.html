<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Football Legends Draft</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; background: #111; color: #fff; margin: 0; padding: 0; }
    #lobby, #game, #results { display: none; padding: 20px; }
    .player { padding: 6px; border-bottom: 1px solid #444; cursor: pointer; }
    .player:hover { background: #222; }
    .selected { background: #008CBA; }
  </style>
</head>
<body>

<div id="lobby">
  <h1>Lobby</h1>
  <button id="createGame">Create Game</button>
  <input type="text" id="gameCodeInput" placeholder="Enter Game Code">
  <button id="joinGame">Join Game</button>
  <div id="playerList"></div>
</div>

<div id="game">
  <h2 id="turnInfo"></h2>
  <div id="pickList"></div>
  <button id="endTurn" disabled>End Turn</button>
</div>

<div id="results">
  <h1>Results</h1>
  <div id="finalScores"></div>
</div>

<script>
  // ===== Firebase Setup =====
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ===== Players (retired) =====
      const ALL_PLAYERS = [
        // GK (16)
        { id: "yashin", name: "Lev Yashin", country: "USSR", position: "GK", rating: 97 },
        { id: "buffon", name: "Gianluigi Buffon", country: "Italy", position: "GK", rating: 94 },
        { id: "casillas", name: "Iker Casillas", country: "Spain", position: "GK", rating: 92 },
        { id: "schmeichel", name: "Peter Schmeichel", country: "Denmark", position: "GK", rating: 93 },
        { id: "maier", name: "Sepp Maier", country: "Germany", position: "GK", rating: 91 },
        { id: "zoff", name: "Dino Zoff", country: "Italy", position: "GK", rating: 92 },
        { id: "kahn", name: "Oliver Kahn", country: "Germany", position: "GK", rating: 93 },
        { id: "banks", name: "Gordon Banks", country: "England", position: "GK", rating: 92 },
        { id: "chilavert", name: "José Luis Chilavert", country: "Paraguay", position: "GK", rating: 89 },
        { id: "higuita", name: "René Higuita", country: "Colombia", position: "GK", rating: 87 },
        { id: "vanDerSar", name: "Edwin van der Sar", country: "Netherlands", position: "GK", rating: 91 },
        { id: "deGeaOld", name: "David de Gea", country: "Spain", position: "GK", rating: 88 },
        { id: "dasaev", name: "Rinat Dasayev", country: "USSR", position: "GK", rating: 91 },
        { id: "valdes", name: "Víctor Valdés", country: "Spain", position: "GK", rating: 88 },
        { id: "seaman", name: "David Seaman", country: "England", position: "GK", rating: 89 },
        { id: "schwarzer", name: "Mark Schwarzer", country: "Australia", position: "GK", rating: 85 },

        // DEF (32)
        { id: "maldini", name: "Paolo Maldini", country: "Italy", position: "DEF", rating: 96 },
        { id: "beckenbauer", name: "Franz Beckenbauer", country: "Germany", position: "DEF", rating: 97 },
        { id: "cafu", name: "Cafu", country: "Brazil", position: "DEF", rating: 90 },
        { id: "carlosalberto", name: "Carlos Alberto", country: "Brazil", position: "DEF", rating: 92 },
        { id: "robertocarlos", name: "Roberto Carlos", country: "Brazil", position: "DEF", rating: 92 },
        { id: "ferdinand", name: "Rio Ferdinand", country: "England", position: "DEF", rating: 90 },
        { id: "puyol", name: "Carles Puyol", country: "Spain", position: "DEF", rating: 91 },
        { id: "baresi", name: "Franco Baresi", country: "Italy", position: "DEF", rating: 95 },
        { id: "montero", name: "Paolo Montero", country: "Uruguay", position: "DEF", rating: 87 },
        { id: "zanetti", name: "Javier Zanetti", country: "Argentina", position: "DEF", rating: 92 },
        { id: "lahm", name: "Philipp Lahm", country: "Germany", position: "DEF", rating: 92 },
        { id: "ramos", name: "Sergio Ramos", country: "Spain", position: "DEF", rating: 92 },
        { id: "hierro", name: "Fernando Hierro", country: "Spain", position: "DEF", rating: 91 },
        { id: "cole", name: "Ashley Cole", country: "England", position: "DEF", rating: 90 },
        { id: "vidic", name: "Nemanja Vidić", country: "Serbia", position: "DEF", rating: 91 },
        { id: "campbell", name: "Sol Campbell", country: "England", position: "DEF", rating: 89 },
        { id: "desailly", name: "Marcel Desailly", country: "France", position: "DEF", rating: 92 },
        { id: "moore", name: "Bobby Moore", country: "England", position: "DEF", rating: 95 },
        { id: "cannavaro", name: "Fabio Cannavaro", country: "Italy", position: "DEF", rating: 94 },
        { id: "nesta", name: "Alessandro Nesta", country: "Italy", position: "DEF", rating: 93 },
        { id: "tassotti", name: "Mauro Tassotti", country: "Italy", position: "DEF", rating: 88 },
        { id: "alba", name: "Jordi Alba", country: "Spain", position: "DEF", rating: 88 },
        { id: "godin", name: "Diego Godín", country: "Uruguay", position: "DEF", rating: 90 },
        { id: "ayala", name: "Roberto Ayala", country: "Argentina", position: "DEF", rating: 90 },
        { id: "brehme", name: "Andreas Brehme", country: "Germany", position: "DEF", rating: 90 },
        { id: "koeman", name: "Ronald Koeman", country: "Netherlands", position: "DEF", rating: 92 },
        { id: "stam", name: "Jaap Stam", country: "Netherlands", position: "DEF", rating: 90 },
        { id: "thuram", name: "Lilian Thuram", country: "France", position: "DEF", rating: 92 },
        { id: "figueroa", name: "Elias Figueroa", country: "Chile", position: "DEF", rating: 93 },
        { id: "scirea", name: "Gaetano Scirea", country: "Italy", position: "DEF", rating: 93 },
        { id: "facchetti", name: "Giacinto Facchetti", country: "Italy", position: "DEF", rating: 93 },
        { id: "santamaria", name: "José Santamaría", country: "Uruguay", position: "DEF", rating: 92 },
        { id: "passarella", name: "Daniel Passarella", country: "Argentina", position: "DEF", rating: 94 },

        // MID (36)
        { id: "zidane", name: "Zinedine Zidane", country: "France", position: "MID", rating: 97 },
        { id: "xavi", name: "Xavi", country: "Spain", position: "MID", rating: 95 },
        { id: "iniesta", name: "Andres Iniesta", country: "Spain", position: "MID", rating: 95 },
        { id: "pirlo", name: "Andrea Pirlo", country: "Italy", position: "MID", rating: 94 },
        { id: "scholes", name: "Paul Scholes", country: "England", position: "MID", rating: 90 },
        { id: "beckham", name: "David Beckham", country: "England", position: "MID", rating: 89 },
        { id: "platini", name: "Michel Platini", country: "France", position: "MID", rating: 95 },
        { id: "kaka", name: "Kaká", country: "Brazil", position: "MID", rating: 92 },
        { id: "ronaldinho", name: "Ronaldinho", country: "Brazil", position: "MID", rating: 95 },
        { id: "matthaus", name: "Lothar Matthäus", country: "Germany", position: "MID", rating: 93 },
        { id: "riquelme", name: "Juan Román Riquelme", country: "Argentina", position: "MID", rating: 92 },
        { id: "lampard", name: "Frank Lampard", country: "England", position: "MID", rating: 90 },
        { id: "gerrard", name: "Steven Gerrard", country: "England", position: "MID", rating: 91 },
        { id: "figo", name: "Luís Figo", country: "Portugal", position: "MID", rating: 93 },
        { id: "modric", name: "Luka Modrić", country: "Croatia", position: "MID", rating: 94 },
        { id: "busquets", name: "Sergio Busquets", country: "Spain", position: "MID", rating: 92 },
        { id: "davids", name: "Edgar Davids", country: "Netherlands", position: "MID", rating: 90 },
        { id: "seedorf", name: "Clarence Seedorf", country: "Netherlands", position: "MID", rating: 92 },
        { id: "schweinsteiger", name: "Bastian Schweinsteiger", country: "Germany", position: "MID", rating: 90 },
        { id: "gullit", name: "Ruud Gullit", country: "Netherlands", position: "MID", rating: 93 },
        { id: "nedved", name: "Pavel Nedvěd", country: "Czech Republic", position: "MID", rating: 93 },
        { id: "rivaldo", name: "Rivaldo", country: "Brazil", position: "MID", rating: 93 },
        { id: "dunga", name: "Dunga", country: "Brazil", position: "MID", rating: 90 },
        { id: "socrates", name: "Sócrates", country: "Brazil", position: "MID", rating: 93 },
        { id: "totti", name: "Francesco Totti", country: "Italy", position: "MID", rating: 93 },
        { id: "zico", name: "Zico", country: "Brazil", position: "MID", rating: 95 },
        { id: "redondo", name: "Fernando Redondo", country: "Argentina", position: "MID", rating: 92 },
        { id: "makalele", name: "Claude Makélélé", country: "France", position: "MID", rating: 91 },
        { id: "kante", name: "N'Golo Kanté", country: "France", position: "MID", rating: 91 },
        { id: "yaya", name: "Yaya Touré", country: "Côte d'Ivoire", position: "MID", rating: 91 },
        { id: "essien", name: "Michael Essien", country: "Ghana", position: "MID", rating: 89 },
        { id: "sammer", name: "Matthias Sammer", country: "Germany", position: "MID", rating: 91 },
        { id: "keane", name: "Roy Keane", country: "Ireland", position: "MID", rating: 90 },
        { id: "veron", name: "Juan Sebastián Verón", country: "Argentina", position: "MID", rating: 90 },
        { id: "iniesta10", name: "Hristo Stoichkov (AM)", country: "Bulgaria", position: "MID", rating: 91 },
        { id: "baggio10", name: "Roberto Baggio (AM)", country: "Italy", position: "MID", rating: 94 },
        { id: "deco", name: "Deco", country: "Portugal", position: "MID", rating: 90 },

        // FWD (40+)
        { id: "pele", name: "Pelé", country: "Brazil", position: "FWD", rating: 99 },
        { id: "maradona", name: "Diego Maradona", country: "Argentina", position: "FWD", rating: 99 },
        { id: "ronaldo", name: "Ronaldo Nazário", country: "Brazil", position: "FWD", rating: 97 },
        { id: "cruyff", name: "Johan Cruyff", country: "Netherlands", position: "FWD", rating: 97 },
        { id: "henry", name: "Thierry Henry", country: "France", position: "FWD", rating: 94 },
        { id: "shevchenko", name: "Andriy Shevchenko", country: "Ukraine", position: "FWD", rating: 92 },
        { id: "batistuta", name: "Gabriel Batistuta", country: "Argentina", position: "FWD", rating: 94 },
        { id: "vanbasten", name: "Marco van Basten", country: "Netherlands", position: "FWD", rating: 96 },
        { id: "eusebio", name: "Eusébio", country: "Portugal", position: "FWD", rating: 95 },
        { id: "muller", name: "Gerd Müller", country: "Germany", position: "FWD", rating: 96 },
        { id: "romario", name: "Romário", country: "Brazil", position: "FWD", rating: 95 },
        { id: "baggio", name: "Roberto Baggio", country: "Italy", position: "FWD", rating: 94 },
        { id: "weah", name: "George Weah", country: "Liberia", position: "FWD", rating: 91 },
        { id: "raul", name: "Raúl", country: "Spain", position: "FWD", rating: 94 },
        { id: "stoichkov", name: "Hristo Stoichkov", country: "Bulgaria", position: "FWD", rating: 93 },
        { id: "bergkamp", name: "Dennis Bergkamp", country: "Netherlands", position: "FWD", rating: 93 },
        { id: "lineker", name: "Gary Lineker", country: "England", position: "FWD", rating: 92 },
        { id: "rush", name: "Ian Rush", country: "Wales", position: "FWD", rating: 91 },
        { id: "delpiero", name: "Alessandro Del Piero", country: "Italy", position: "FWD", rating: 93 },
        { id: "inzaghi", name: "Filippo Inzaghi", country: "Italy", position: "FWD", rating: 89 },
        { id: "klinsmann", name: "Jürgen Klinsmann", country: "Germany", position: "FWD", rating: 91 },
        { id: "shearer", name: "Alan Shearer", country: "England", position: "FWD", rating: 94 },
        { id: "fowler", name: "Robbie Fowler", country: "England", position: "FWD", rating: 89 },
        { id: "owen", name: "Michael Owen", country: "England", position: "FWD", rating: 90 },
        { id: "etoo", name: "Samuel Eto'o", country: "Cameroon", position: "FWD", rating: 93 },
        { id: "zlatan", name: "Zlatan Ibrahimović", country: "Sweden", position: "FWD", rating: 92 },
        { id: "ronaldinhoF", name: "Ronaldinho (FWD)", country: "Brazil", position: "FWD", rating: 94 },
        { id: "rivaldoF", name: "Rivaldo (FWD)", country: "Brazil", position: "FWD", rating: 93 },
        { id: "klose", name: "Miroslav Klose", country: "Germany", position: "FWD", rating: 91 },
        { id: "crespo", name: "Hernán Crespo", country: "Argentina", position: "FWD", rating: 91 },
        { id: "aguero", name: "Sergio Agüero", country: "Argentina", position: "FWD", rating: 92 },
        { id: "torres", name: "Fernando Torres", country: "Spain", position: "FWD", rating: 90 },
        { id: "villa", name: "David Villa", country: "Spain", position: "FWD", rating: 91 },
        { id: "papin", name: "Jean-Pierre Papin", country: "France", position: "FWD", rating: 90 },
        { id: "sanchez", name: "Hugo Sánchez", country: "Mexico", position: "FWD", rating: 94 },
        { id: "rummenigge", name: "Karl-Heinz Rummenigge", country: "Germany", position: "FWD", rating: 94 },
        { id: "cantona", name: "Eric Cantona", country: "France", position: "FWD", rating: 92 },
        { id: "rossi", name: "Paolo Rossi", country: "Italy", position: "FWD", rating: 92 },
        { id: "ginola", name: "David Ginola", country: "France", position: "FWD", rating: 88 },
        { id: "litmanen", name: "Jari Litmanen", country: "Finland", position: "FWD", rating: 89 },
        { id: "suker", name: "Davor Šuker", country: "Croatia", position: "FWD", rating: 92 },
        { id: "rooney", name: "Wayne Rooney", country: "England", position: "FWD", rating: 92 },
        { id: "dalglish", name: "Kenny Dalglish", country: "Scotland", position: "FWD", rating: 93 },
        { id: "law", name: "Denis Law", country: "Scotland", position: "FWD", rating: 92 },
        { id: "greaves", name: "Jimmy Greaves", country: "England", position: "FWD", rating: 94 }
      ];


  // ===== Game Variables =====
  let gameId = null;
  let playerId = null;
  let playerRole = null;
  let unsubscribeGame = null;
  let myTeam = [];

  // ===== DOM Elements =====
  const lobbyDiv = document.getElementById("lobby");
  const gameDiv = document.getElementById("game");
  const resultsDiv = document.getElementById("results");
  const pickList = document.getElementById("pickList");
  const turnInfo = document.getElementById("turnInfo");
  const playerListDiv = document.getElementById("playerList");

  // ===== Create Game =====
  document.getElementById("createGame").onclick = async () => {
    playerId = `P${Date.now()}`;
    const docRef = await db.collection("games").add({
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      players: { [playerId]: { name: "Player 1", team: [], score: 0 } },
      status: "waiting",
      turn: playerId
    });
    gameId = docRef.id;
    playerRole = "host";
    subscribeToGame();
  };

  // ===== Join Game =====
  document.getElementById("joinGame").onclick = async () => {
    const code = document.getElementById("gameCodeInput").value.trim();
    if (!code) return;
    const gameRef = db.collection("games").doc(code);
    const snap = await gameRef.get();
    if (!snap.exists) return alert("Game not found");
    playerId = `P${Date.now()}`;
    await gameRef.update({
      [`players.${playerId}`]: { name: "Player 2", team: [], score: 0 },
      status: "active"
    });
    gameId = code;
    playerRole = "guest";
    subscribeToGame();
  };

  // ===== Subscribe to Game =====
  function subscribeToGame() {
    unsubscribeGame = db.collection("games").doc(gameId).onSnapshot((doc) => {
      const game = doc.data();
      if (!game) return;

      // Show player list with scores
      playerListDiv.innerHTML = Object.values(game.players)
        .map(p => `${p.name} - Score: ${p.score}`)
        .join("<br>");

      if (game.status === "waiting") {
        lobbyDiv.style.display = "block";
        gameDiv.style.display = "none";
      } else if (game.status === "active") {
        lobbyDiv.style.display = "none";
        gameDiv.style.display = "block";
        renderGame(game);
      } else if (game.status === "finished") {
        lobbyDiv.style.display = "none";
        gameDiv.style.display = "none";
        resultsDiv.style.display = "block";
        renderResults(game);
      }
    });
  }

  // ===== Render Game =====
  function renderGame(game) {
    const myData = game.players[playerId];
    const isMyTurn = game.turn === playerId;

    turnInfo.textContent = isMyTurn ? "Your Turn" : "Opponent's Turn";
    document.getElementById("endTurn").disabled = !isMyTurn || myTeam.length === 0;

    const takenIds = Object.values(game.players).flatMap(p => p.team);
    const availablePlayers = ALL_PLAYERS.filter(p => !takenIds.includes(p.id));

    pickList.innerHTML = availablePlayers.map(p => `
      <div class="player" onclick="selectPlayer('${p.id}')" id="p-${p.id}">
        ${p.name} (${p.position}) - ${p.rating}
      </div>
    `).join('');
  }

  // ===== Select Player =====
  window.selectPlayer = (id) => {
    if (!gameId) return;
    myTeam.push(id);
    document.getElementById(`p-${id}`).classList.add("selected");
    document.getElementById("endTurn").disabled = false;
  };

  // ===== End Turn =====
  document.getElementById("endTurn").onclick = async () => {
    const gameRef = db.collection("games").doc(gameId);
    const snap = await gameRef.get();
    const game = snap.data();
    const opponentId = Object.keys(game.players).find(pid => pid !== playerId);

    await gameRef.update({
      [`players.${playerId}.team`]: firebase.firestore.FieldValue.arrayUnion(...myTeam),
      turn: opponentId
    });
    myTeam = [];

    // End game if all players picked
    const totalPicked = Object.values(game.players).flatMap(p => p.team).length;
    if (totalPicked >= ALL_PLAYERS.length) {
      const scores = {};
      for (const pid in game.players) {
        scores[pid] = computeTeamScore(game.players[pid].team);
      }
      await gameRef.update({
        status: "finished",
        [`players.${Object.keys(game.players)[0]}.score`]: scores[Object.keys(game.players)[0]],
        [`players.${Object.keys(game.players)[1]}.score`]: scores[Object.keys(game.players)[1]]
      });
    }
  };

  // ===== Compute Team Score =====
  function computeTeamScore(team) {
    let total = team.reduce((sum, pid) => {
      const player = ALL_PLAYERS.find(p => p.id === pid);
      return sum + (player ? player.rating : 0);
    }, 0);
    return total + Math.floor(Math.random() * 10); // Small randomness
  }

  // ===== Render Results =====
  function renderResults(game) {
    const results = Object.values(game.players)
      .map(p => `${p.name}: ${p.score}`)
      .join("<br>");
    document.getElementById("finalScores").innerHTML = results;
  }
</script>
</body>
</html>
