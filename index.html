<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Winning Side — Standalone</title>
    <!-- Tailwind via CDN (for quick testing) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 + Babel for in-browser JSX transpile (dev only) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
      const { useMemo, useState, useEffect } = React;

      // === Brand config ===
      const LOGO_URL = "https://dummyimage.com/160x40/059669/ffffff&text=Winning+Side"; // swap with your logo URL


      const ALL_PLAYERS = [
        // GKs
        { id: "yashin", name: "Lev Yashin", country: "USSR", position: "GK", rating: 97 },
        { id: "buffon", name: "Gianluigi Buffon", country: "Italy", position: "GK", rating: 94 },
        { id: "casillas", name: "Iker Casillas", country: "Spain", position: "GK", rating: 92 },
        { id: "schmeichel", name: "Peter Schmeichel", country: "Denmark", position: "GK", rating: 93 },
        { id: "maier", name: "Sepp Maier", country: "Germany", position: "GK", rating: 91 },
        { id: "zoff", name: "Dino Zoff", country: "Italy", position: "GK", rating: 92 },

        // DEFs
        { id: "maldini", name: "Paolo Maldini", country: "Italy", position: "DEF", rating: 96 },
        { id: "beckenbauer", name: "Franz Beckenbauer", country: "Germany", position: "DEF", rating: 97 },
        { id: "cafu", name: "Cafu", country: "Brazil", position: "DEF", rating: 90 },
        { id: "carlosalberto", name: "Carlos Alberto", country: "Brazil", position: "DEF", rating: 92 },
        { id: "robertocarlos", name: "Roberto Carlos", country: "Brazil", position: "DEF", rating: 92 },
        { id: "ferdinand", name: "Rio Ferdinand", country: "England", position: "DEF", rating: 90 },
        { id: "puyol", name: "Carles Puyol", country: "Spain", position: "DEF", rating: 91 },
        { id: "baresi", name: "Franco Baresi", country: "Italy", position: "DEF", rating: 95 },
        { id: "montero", name: "Paolo Montero", country: "Uruguay", position: "DEF", rating: 87 },

        // MIDs
        { id: "zidane", name: "Zinedine Zidane", country: "France", position: "MID", rating: 97 },
        { id: "xavi", name: "Xavi", country: "Spain", position: "MID", rating: 95 },
        { id: "iniesta", name: "Andres Iniesta", country: "Spain", position: "MID", rating: 95 },
        { id: "pirlo", name: "Andrea Pirlo", country: "Italy", position: "MID", rating: 94 },
        { id: "scholes", name: "Paul Scholes", country: "England", position: "MID", rating: 90 },
        { id: "beckham", name: "David Beckham", country: "England", position: "MID", rating: 89 },
        { id: "platini", name: "Michel Platini", country: "France", position: "MID", rating: 95 },
        { id: "kaka", name: "Kaká", country: "Brazil", position: "MID", rating: 92 },
        { id: "ronaldinho", name: "Ronaldinho", country: "Brazil", position: "MID", rating: 95 },
        { id: "matthaus", name: "Lothar Matthäus", country: "Germany", position: "MID", rating: 93 },
        { id: "riquelme", name: "Juan Román Riquelme", country: "Argentina", position: "MID", rating: 92 },
        { id: "lampard", name: "Frank Lampard", country: "England", position: "MID", rating: 90 },
        { id: "gerrard", name: "Steven Gerrard", country: "England", position: "MID", rating: 91 },

        // FWDs
        { id: "pele", name: "Pelé", country: "Brazil", position: "FWD", rating: 99 },
        { id: "maradona", name: "Diego Maradona", country: "Argentina", position: "FWD", rating: 99 },
        { id: "ronaldo", name: "Ronaldo Nazário", country: "Brazil", position: "FWD", rating: 97 },
        { id: "cruyff", name: "Johan Cruyff", country: "Netherlands", position: "FWD", rating: 97 },
        { id: "henry", name: "Thierry Henry", country: "France", position: "FWD", rating: 94 },
        { id: "shevchenko", name: "Andriy Shevchenko", country: "Ukraine", position: "FWD", rating: 92 },
        { id: "batistuta", name: "Gabriel Batistuta", country: "Argentina", position: "FWD", rating: 94 },
        { id: "vanbasten", name: "Marco van Basten", country: "Netherlands", position: "FWD", rating: 96 },
        { id: "eusebio", name: "Eusébio", country: "Portugal", position: "FWD", rating: 95 },
        { id: "muller", name: "Gerd Müller", country: "Germany", position: "FWD", rating: 96 },
        { id: "romario", name: "Romário", country: "Brazil", position: "FWD", rating: 95 },
        { id: "baggio", name: "Roberto Baggio", country: "Italy", position: "FWD", rating: 94 },
        { id: "weah", name: "George Weah", country: "Liberia", position: "FWD", rating: 91 },
      ];

      const POS_LIMITS = { GK: 1, DEF: 1, MID: 2, FWD: 2 };
      const POSITION_ORDER = ["GK", "DEF", "MID", "FWD"]; // display order

      const cloneTeam = () => ({ GK: [], DEF: [], MID: [], FWD: [], skipsLeft: 1 });

      const getCountriesFrom = (players) => Array.from(new Set(players.map(p => p.country))).sort();

      function teamNeeds(team) {
        return POSITION_ORDER.reduce((acc, pos) => {
          acc[pos] = Math.max(0, POS_LIMITS[pos] - team[pos].length);
          return acc;
        }, {});
      }

      function isTeamFull(team) {
        const needs = teamNeeds(team);
        return POSITION_ORDER.every(pos => needs[pos] === 0);
      }

      function eligiblePlayersForTeam(players, country, team, alreadyPickedIds) {
        const needs = teamNeeds(team);
        return players.filter(p => p.country === country && !alreadyPickedIds.has(p.id) && needs[p.position] > 0);
      }

      const average = (arr) => arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0;

      function computeTeamScore(team) {
        // GK 15%, DEF 20%, MID 30%, FWD 35% + luck (±3)
        const gkAvg = average(team.GK.map(p => p.rating));
        const defAvg = average(team.DEF.map(p => p.rating));
        const midAvg = average(team.MID.map(p => p.rating));
        const fwdAvg = average(team.FWD.map(p => p.rating));
        const base = 0.15 * gkAvg + 0.20 * defAvg + 0.30 * midAvg + 0.35 * fwdAvg;
        const luck = (Math.random() * 6) - 3;
        const score = Math.max(0, Math.min(100, base + luck));
        return { base: Number(base.toFixed(2)), luck: Number(luck.toFixed(2)), final: Number(score.toFixed(2)) };
      }

      const Roster = ({ team, title }) => {
        const needs = teamNeeds(team);
        return (
          <div className="rounded-2xl p-4 shadow bg-white/70">
            <div className="text-lg font-semibold mb-2">{title}</div>
            <div className="grid grid-cols-2 gap-3">
              {POSITION_ORDER.map(pos => (
                <div key={pos} className="border rounded-xl p-3">
                  <div className="text-xs uppercase tracking-wider text-gray-600">{pos}</div>
                  {Array.from({ length: POS_LIMITS[pos] }).map((_, idx) => (
                    <div key={idx} className="mt-1 text-sm">
                      {team[pos][idx] ? (
                        <div className="font-medium">{team[pos][idx].name} <span className="text-gray-500">({team[pos][idx].country})</span></div>
                      ) : (
                        <div className="text-gray-400 italic">Empty slot</div>
                      )}
                    </div>
                  ))}
                  {needs[pos] > 0 && (
                    <div className="text-[11px] text-amber-700 mt-1">Need {needs[pos]} more</div>
                  )}
                </div>
              ))}
            </div>
            <div className="mt-2 text-xs text-gray-500">Skips left: {team.skipsLeft}</div>
          </div>
        );
      };

      const CountryBadge = ({ country }) => (
        <span className="px-2 py-1 rounded-full bg-emerald-100 text-emerald-800 text-xs font-medium">{country}</span>
      );

      const PlayerCard = ({ p, onPick }) => (
        <button onClick={() => onPick(p)} className="w-full text-left border rounded-xl p-3 hover:shadow transition">
          <div className="font-medium">{p.name}</div>
          <div className="text-xs text-gray-600">{p.country}</div>
        </button>
      );

      const Divider = () => <div className="h-px bg-gray-200 my-4" />;

      function App() {
        const [players] = useState(ALL_PLAYERS);
        const [countries] = useState(getCountriesFrom(players));

        const [team1, setTeam1] = useState(cloneTeam());
        const [team2, setTeam2] = useState(cloneTeam());
        const [pickedIds, setPickedIds] = useState(new Set());
        const [firstPicker, setFirstPicker] = useState(null); // 1 or 2
        const [turn, setTurn] = useState(1);
        const [currentCountry, setCurrentCountry] = useState(null);
        const [winner, setWinner] = useState(null);
        const [scores, setScores] = useState(null);

        useEffect(() => { newMatch(); }, []);

        function newMatch() {
          setTeam1(cloneTeam());
          setTeam2(cloneTeam());
          setPickedIds(new Set());
          const coin = Math.random() < 0.5 ? 1 : 2;
          setFirstPicker(coin);
          setTurn(coin);
          setWinner(null);
          setScores(null);
          rollCountry(coin);
        }

        const currentTeamRef = (which) => (which === 1 ? team1 : team2);
        const setCurrentTeam = (which, value) => (which === 1 ? setTeam1(value) : setTeam2(value));

        function rollCountry(forPlayer) {
          const maxAttempts = 20;
          for (let i = 0; i < maxAttempts; i++) {
            const c = countries[Math.floor(Math.random() * countries.length)];
            const eligible = eligiblePlayersForTeam(players, c, currentTeamRef(forPlayer), pickedIds);
            if (eligible.length > 0) { setCurrentCountry(c); return; }
          }
          setCurrentCountry(null);
        }

        const eligibleList = useMemo(() => {
          if (!currentCountry) return [];
          return eligiblePlayersForTeam(players, currentCountry, currentTeamRef(turn), pickedIds);
        }, [players, currentCountry, team1, team2, pickedIds, turn]);

        function useSkip() {
          const t = currentTeamRef(turn);
          if (t.skipsLeft <= 0) return;
          const updated = { ...t, skipsLeft: t.skipsLeft - 1 };
          setCurrentTeam(turn, updated);
          rollCountry(turn);
        }

        function addPlayerToTeam(whichTeam, player) {
          const t = currentTeamRef(whichTeam);
          const copy = { ...t, GK: [...t.GK], DEF: [...t.DEF], MID: [...t.MID], FWD: [...t.FWD] };
          copy[player.position].push(player);
          setCurrentTeam(whichTeam, copy);
          const newPicked = new Set(pickedIds); newPicked.add(player.id); setPickedIds(newPicked);
        }

        function handlePick(p) {
          addPlayerToTeam(turn, p);
          const nextTurn = turn === 1 ? 2 : 1;

          const team1Next = turn === 1 ? { ...team1, [p.position]: [...team1[p.position], p] } : team1;
          const team2Next = turn === 2 ? { ...team2, [p.position]: [...team2[p.position], p] } : team2;

          if (isTeamFull(team1Next) && isTeamFull(team2Next)) {
            const s1 = computeTeamScore(team1Next);
            const s2 = computeTeamScore(team2Next);
            const w = s1.final > s2.final ? 1 : s2.final > s1.final ? 2 : (Math.random() < 0.5 ? 1 : 2);
            setScores({ p1: s1, p2: s2 });
            setWinner(w);
            setCurrentCountry(null);
            return;
          }

          setTurn(nextTurn);
          setTimeout(() => rollCountry(nextTurn), 50);
        }

        const gameOver = winner !== null;

        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 md:p-8">
            <div className="max-w-6xl mx-auto">
              <header className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <img src={LOGO_URL} alt="Winning Side" className="h-8 w-auto rounded" />
                  <h1 className="text-2xl md:text-3xl font-bold text-emerald-700">Winning Side — Prototype</h1>
                </div>
                <button onClick={newMatch} className="px-3 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm shadow">
                  New Match
                </button>
              </header>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <Roster team={team1} title="Player 1" />
                <Roster team={team2} title="Player 2" />
              </div>

              <Divider />

              {!gameOver ? (
                <div className="rounded-2xl p-4 md:p-6 bg-white shadow">
                  <div className="flex flex-wrap items-center gap-2 mb-3">
                    <div className="text-sm">First picker: <span className="font-semibold">Player {firstPicker}</span></div>
                    <div className="text-sm">Current turn: <span className="font-semibold">Player {turn}</span></div>
                    {currentCountry && <div className="text-sm flex items-center gap-2">Country: <CountryBadge country={currentCountry} /></div>}
                  </div>

                  {!currentCountry && (
                    <div className="text-sm text-gray-600 mb-2">No eligible players for the rolled country. Rerolling…</div>
                  )}

                  <div className="flex items-center justify-between mb-2">
                    <div className="text-base font-semibold">Select a player</div>
                    <button onClick={useSkip} disabled={(turn === 1 ? team1.skipsLeft : team2.skipsLeft) <= 0} className="text-sm px-3 py-2 rounded-xl border hover:bg-slate-50 disabled:opacity-50">
                      Use Skip ({turn === 1 ? team1.skipsLeft : team2.skipsLeft} left)
                    </button>
                  </div>

                  <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    {eligibleList.length === 0 && (
                      <div className="text-sm text-gray-500">No eligible players for this country and your remaining positions. Try Skip.</div>
                    )}
                    {eligibleList.map(p => (
                      <PlayerCard key={p.id} p={p} onPick={handlePick} />
                    ))}
                  </div>

                  <div className="text-[11px] text-gray-500 mt-3">* Only name & country shown; ratings are hidden for the simulation.</div>
                </div>
              ) : (
                <div className="rounded-2xl p-4 md:p-6 bg-white shadow">
                  <div className="text-xl font-semibold mb-2">Result</div>
                  <div className="mb-3">Winner: <span className="font-bold">Player {winner}</span></div>
                  {scores && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="border rounded-xl p-3">
                        <div className="font-medium mb-1">Player 1</div>
                        <div className="text-sm">Base: {scores.p1.base}</div>
                        <div className="text-sm">Luck: {scores.p1.luck}</div>
                        <div className="text-sm font-semibold">Final: {scores.p1.final}</div>
                      </div>
                      <div className="border rounded-xl p-3">
                        <div className="font-medium mb-1">Player 2</div>
                        <div className="text-sm">Base: {scores.p2.base}</div>
                        <div className="text-sm">Luck: {scores.p2.luck}</div>
                        <div className="text-sm font-semibold">Final: {scores.p2.final}</div>
                      </div>
                    </div>
                  )}
                  <div className="mt-4">
                    <button onClick={newMatch} className="px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm">Play Again</button>
                  </div>
                </div>
              )}

              <Divider />

              <details className="text-xs text-gray-600">
                <summary className="cursor-pointer">How it works</summary>
                <div className="mt-2 space-y-1">
                  <div>- Six-a-side roster: 1 GK, 1 DEF, 2 MID, 2 FWD.</div>
                  <div>- Each turn rolls a random country. You can only pick players from that country that fit your remaining slots.</div>
                  <div>- Each player has one Skip to reroll the country.</div>
                  <div>- Final score combines weighted position ratings + a small luck factor (±3).</div>
                </div>
              </details>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
